@page "/Login"

@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject ILocalStorageService LocalStorage
@inject ICurrentUser CurrentUser

<PageTitle>Login to our service</PageTitle>

<MudContainer>
    <MudTextField @bind-Value="_request.Email" Label="Email" T="string" InputType="InputType.Email"></MudTextField>
    <MudTextField @bind-Value="_request.Password" Label="Password" T="string"
                  InputType="InputType.Password"></MudTextField>
    <MudButton Variant="Variant.Filled" Color="Color.Success" OnClick="LoginClicked">Login</MudButton>
</MudContainer>
<MudLink Href="/Register">Don't have account? Register</MudLink>

@code {
    private readonly LoginRequest _request = new();

    private async Task LoginClicked()
    {
        // TODO: send to API

        // var response = await Http.PostAsJsonAsync("X", _request);
        // var content = await response.Content.ReadFromJsonAsync<LoginResponse>();

        CurrentUser.UserId = Guid.Empty;
        CurrentUser.Email = _request.Email;
        CurrentUser.UserName = "";

        await LocalStorage.SetItemAsync("user", CurrentUser);

        NavigationManager.NavigateTo("/");
    }

}